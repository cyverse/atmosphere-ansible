---
PURGE_SETTING: "purge=yes"

XGUI:
  xsession_path: /usr/bin/X
  xterm_path: /usr/bin/xinit
  vnc_dependencies:
    - libfam0
    - libxext-dev 
    - libx11-dev 
    - libc6-dev 
    - libthunar-vfs-1-2 
    - libc6
  packages_to_remove:
    - realvnc-vnc-server
  packages:
    - vnc4server
    - novnc
  type: name
  extra_args: update_cache=yes
  files_to_add:
    - { FROM: passwd, TO: "/home/{{ ATMOUSERNAME }}/.vnc/passwd" }
    - { FROM: vncserver.custom, TO: /etc/pam.d/vncserver.custom }
    - { FROM: common.custom, TO: /etc/vnc/config.d/common.custom }
    - { FROM: config.custom, TO: /etc/vnc/config.custom }
    #- { FROM: , TO:  }
  files_to_remove:
    - { PATH: /tmp/.X1-lock, STATE: absent }
    - { PATH: /tmp/.X11-unix, STATE: absent }
    - { PATH: /tmp/.X11-unix, STATE: directory }
    - { PATH: /tmp/VNC-Server-5.2.3-Linux-x64.deb, STATE: absent }
  dirs_to_make:
    - { PATH: /tmp/.X11-unix, STATE: directory, MODE: "a+rwxt" }
    - { PATH: /etc/vnc, STATE: directory, MODE: "0755" }

VNC_COMMANDS:
  - /usr/bin/pkill websockify
  - for i in $(/usr/bin/pgrep -f "python /opt/kanaka-noVNC-8b0a0f6/utils/websockify/run");do /bin/kill -HUP $i;done
  - /bin/su {{ ATMOUSERNAME }} -c '/usr/bin/vncserver -localhost :1'
  - /opt/kanaka-noVNC-8b0a0f6/utils/launch.sh --listen 4200 --vnc localhost:5901 &

